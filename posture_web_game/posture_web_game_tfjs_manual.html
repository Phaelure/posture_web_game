<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å§¿å‹¢ãƒã‚§ãƒƒã‚¯ï¼ˆæ‰‹å‹•ãƒ­ãƒ¼ãƒ‰ç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0"></script>
<style>
body{font-family:system-ui;background:#f8fafc;color:#0f172a;margin:0;padding:20px;}
h1{color:#2563eb;}
pre{background:#f1f5f9;border-radius:8px;padding:10px;overflow:auto;}
.status{padding:10px;margin:10px 0;border-radius:8px;}
.ok{background:#dcfce7;color:#166534;}
.err{background:#fee2e2;color:#991b1b;}
</style>
</head>

<body>
<h1>å§¿å‹¢ãƒã‚§ãƒƒã‚¯ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ï¼ˆæ‰‹å‹•ç¢ºèªç‰ˆï¼‰</h1>
<div id="log" class="status">â³ æº–å‚™ä¸­...</div>
<pre id="output"></pre>

<script>
async function manualLoadModel(){
  const log = msg => document.getElementById('log').textContent = msg;
  const output = document.getElementById('output');
  try {
    // âœ… Step1: æ‰‹å‹•ã§ model.json ã‚’èª­ã¿è¾¼ã‚€
    log("ğŸ“¦ model.json ã‚’å–å¾—ä¸­...");
    const modelResponse = await fetch("./model/model.json");
    if(!modelResponse.ok) throw new Error("model.json ã®å–å¾—å¤±æ•—: " + modelResponse.status);
    const modelJson = await modelResponse.json();

    // âœ… Step2: è§£æ weights.bin ã®ãƒ‘ã‚¹
    const weightPath = modelJson.weightsManifest[0].paths[0];
    log("âœ… model.json èª­ã¿è¾¼ã¿æˆåŠŸã€‚weights.bin: " + weightPath);

    // âœ… Step3: æ‰‹å‹•ã§ weights.bin ã®å­˜åœ¨ã‚’ç¢ºèª
    const weightResponse = await fetch("./model/" + weightPath, {method:"HEAD"});
    if(weightResponse.ok){
      log("âœ… weights.bin æ¤œå‡ºæ¸ˆã¿ã€‚ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­...");
    } else {
      throw new Error("weights.bin ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
    }

    // âœ… Step4: TensorFlow.js ã§å®Ÿéš›ã«ãƒ­ãƒ¼ãƒ‰
    const model = await tf.loadLayersModel("./model/model.json");
    log("âœ… ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†ï¼");
    console.log(model.summary ? model.summary() : model);

    // âœ… Step5: ç¢ºèªå‡ºåŠ›
    output.textContent = JSON.stringify(modelJson, null, 2);
    document.getElementById('log').className = "status ok";
  } catch (err){
    document.getElementById('log').className = "status err";
    document.getElementById('log').textContent = "âŒ ã‚¨ãƒ©ãƒ¼: " + err.message;
    console.error(err);
  }
}

manualLoadModel();
</script>
</body>
</html>
